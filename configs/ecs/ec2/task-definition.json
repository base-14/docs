{
  "executionRoleArn": "${AWS_TASK_EXECUTION_ROLE}",
  "containerDefinitions": [
    {
      "portMappings": [
        {
          "name": "grpc-port",
          "containerPort": 4317,
          "hostPort": 4317,
          "protocol": "tcp"
        },
        {
          "name": "http-port",
          "containerPort": 4318,
          "hostPort": 4318,
          "protocol": "tcp"
        },
        {
          "name": "fluentforward-port",
          "containerPort": 24224,
          "hostPort": 24224,
          "protocol": "tcp"
        }
      ],
      "cpu": 256,
      "memory": 512,
      "image": "otel/opentelemetry-collector-contrib:0.130.0",
      "essential": true,
      "command": [
        "--config=env:SCOUT_CONFIG_CONTENT"
      ],
      "mountPoints": [
        {
          "sourceVolume": "docker_sock",
          "containerPath": "/var/run/docker.sock",
          "readOnly": true
        },
        {
          "sourceVolume": "proc",
          "containerPath": "/rootfs/proc",
          "readOnly": true
        },
        {
          "sourceVolume": "dev",
          "containerPath": "/rootfs/dev",
          "readOnly": true
        },
        {
          "sourceVolume": "al2_cgroup",
          "containerPath": "/rootfs/sys/fs/cgroup",
          "readOnly": true
        },
        {
          "sourceVolume": "tmpfs",
          "containerPath": "/rootfs/tmp",
          "readOnly": false
        },
        {
          "sourceVolume": "al1_cgroup",
          "containerPath": "/rootfs/cgroup",
          "readOnly": true
        }
      ],
      "volumesFrom": [],
      "name": "${TASK_NAME}",
      "secrets": [
        {
          "name": "SCOUT_CONFIG_CONTENT",
          "valueFrom": "${SECRET_ARN}"
        }
      ],
      "systemControls": []
    }
  ],
  "family": "${SERVICE_NAME}",
  "requiresCompatibilities": [
    "EC2"
  ],
  "networkMode": "bridge",
  "volumes": [
    {
      "name": "docker_sock",
      "host": {
        "sourcePath": "/var/run/docker.sock"
      }
    },
    {
      "name": "proc",
      "host": {
        "sourcePath": "/proc"
      }
    },
    {
      "name": "dev",
      "host": {
        "sourcePath": "/dev"
      }
    },
    {
      "name": "al2_cgroup",
      "host": {
        "sourcePath": "/sys/fs/cgroup"
      }
    },
    {
      "name": "tmpfs",
      "host": {
        "sourcePath": "/tmp"
      }
    },
    {
      "name": "al1_cgroup",
      "host": {
        "sourcePath": "/cgroup"
      }
    }
  ]
}
